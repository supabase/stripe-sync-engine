import { readFileSync, writeFileSync } from 'fs'
import { join, dirname } from 'path'
import { fileURLToPath } from 'url'

const __dirname = dirname(fileURLToPath(import.meta.url))
const edgeFunctionsDir = join(__dirname, '../src/edge-functions')
const outputFile = join(__dirname, '../src/edge-function-code.ts')

const setupCode = readFileSync(join(edgeFunctionsDir, 'stripe-setup.ts'), 'utf-8')
const webhookCode = readFileSync(join(edgeFunctionsDir, 'stripe-webhook.ts'), 'utf-8')
const workerCode = readFileSync(join(edgeFunctionsDir, 'stripe-worker.ts'), 'utf-8')

const content = `// Auto-generated file - do not edit manually
// Generated by scripts/build-edge-functions.js

export const setupFunctionCode = ${JSON.stringify(setupCode)}

export const webhookFunctionCode = ${JSON.stringify(webhookCode)}

export const workerFunctionCode = ${JSON.stringify(workerCode)}
`

writeFileSync(outputFile, content)
console.log('Generated edge-function-code.ts')
